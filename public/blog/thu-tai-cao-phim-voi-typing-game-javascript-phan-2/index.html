<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Thử tài cào phím với Typing Game - Javascript (phần 2) | Tech&#39;s Blog</title>
<meta name="keywords" content="FrontEnd, Javascript, Web, Game">
<meta name="description" content="Chào mọi người, ở bài viết trước mình đã hướng dẫn các bạn render các từ trong một đoạn văn bản ra ngoài giao diện, đồng thời chúng ta cũng có thể chuyển đổi ngôn ngữ từ tiếng việt sang tiếng anh hoặc ngược lại nếu muốn">
<meta name="author" content="">
<link rel="canonical" href="https://buihien.org/blog/thu-tai-cao-phim-voi-typing-game-javascript-phan-2/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.a72801f0f40a8d7f71aa1cafd1c2f2a993a1f26ca1cfd38fdba65d5b9b0f08a0.css" integrity="sha256-pygB8PQKjX9xqhyv0cLyqZOh8myhz9OP26ZdW5sPCKA=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js" integrity="sha256-uVus3DnjejMqn4g7Hni&#43;Srwf3KK8HyZB9V4809q9TWE="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://buihien.org/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://buihien.org/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://buihien.org/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://buihien.org/apple-touch-icon.png">
<link rel="mask-icon" href="https://buihien.org/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Thử tài cào phím với Typing Game - Javascript (phần 2)" />
<meta property="og:description" content="Chào mọi người, ở bài viết trước mình đã hướng dẫn các bạn render các từ trong một đoạn văn bản ra ngoài giao diện, đồng thời chúng ta cũng có thể chuyển đổi ngôn ngữ từ tiếng việt sang tiếng anh hoặc ngược lại nếu muốn" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://buihien.org/blog/thu-tai-cao-phim-voi-typing-game-javascript-phan-2/" />
<meta property="og:image" content="https://buihien.org/blog/typing-game/typing-game-2.png" /><meta property="article:section" content="blog" />



<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://buihien.org/blog/typing-game/typing-game-2.png" />
<meta name="twitter:title" content="Thử tài cào phím với Typing Game - Javascript (phần 2)"/>
<meta name="twitter:description" content="Chào mọi người, ở bài viết trước mình đã hướng dẫn các bạn render các từ trong một đoạn văn bản ra ngoài giao diện, đồng thời chúng ta cũng có thể chuyển đổi ngôn ngữ từ tiếng việt sang tiếng anh hoặc ngược lại nếu muốn"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Blogs",
      "item": "https://buihien.org/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Thử tài cào phím với Typing Game - Javascript (phần 2)",
      "item": "https://buihien.org/blog/thu-tai-cao-phim-voi-typing-game-javascript-phan-2/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Thử tài cào phím với Typing Game - Javascript (phần 2)",
  "name": "Thử tài cào phím với Typing Game - Javascript (phần 2)",
  "description": "Chào mọi người, ở bài viết trước mình đã hướng dẫn các bạn render các từ trong một đoạn văn bản ra ngoài giao diện, đồng thời chúng ta cũng có thể chuyển đổi ngôn ngữ từ tiếng việt sang tiếng anh hoặc ngược lại nếu muốn",
  "keywords": [
    "FrontEnd", "Javascript", "Web", "Game"
  ],
  "articleBody": "Chào mọi người, ở bài viết trước mình đã hướng dẫn các bạn render các từ trong một đoạn văn bản ra ngoài giao diện, đồng thời chúng ta cũng có thể chuyển đổi ngôn ngữ từ tiếng việt sang tiếng anh hoặc ngược lại nếu muốn\nTrong khuôn khổ bài viết bài này, chúng ta cũng nhau đi thực hiện một số công việc tiếp theo trong Typing Game bao gồm :\nĐếm ngược thời gian Xử lý khi gõ từ Nếu các bạn thích chủ đề làm Game và Ứng dụng bằng Javascript thì hãy comment ở bên dưới bài viết cho mình biết nhé 😆\nBây giờ thì cùng bắt đầu thôi nào 😄\nĐếm ngược thời gian const timeEl = document.querySelector('#time'); let time; let interval; let isPlaying; function init() { time = 60; index = 0; isPlaying = false; // Chọn ngôn ngữ // Đổi vị trí các từ trong mảng // Render từ // Hiển thị thời gian timeEl.innerText = convertTime(time); // Highlight từ đầu tiên } Ở đoạn code trên mình có khai báo 3 biến : time, interval, isPlaying\ntime : Thời gian chơi game (khi bắt đầu game thì time sẽ bắt đầu đếm ngược) interval : Lưu trữ giá trị của hàm setInterval() (phục vụ cho mục đích đếm ngược thời gian), về sau khi thời gian = 0, lúc này mình sẽ dùng hàm clearInterval() để dừng quá trình đếm ngược thời gian dựa vào biến interval isPlaying : Đây là biến để kiểm tra xem người chơi đã bắt đầu gõ phím chưa để chúng ta bắt đầu quá trình đếm ngược thời gian Trong function init() mình sẽ khởi tạo giá trị time = 60 (thời gian chơi game là 60s), isPlaying = false (người chơi chưa gõ phím để bắt đầu). Đồng thời cũng hiển thị thời gian lên trên giao diện (mới chỉ hiển thị thôi nhé, chứ chưa đếm ngược đâu)\n// Hiển thị thời gian timeEl.innerText = convertTime(time); Vì mình muốn thời gian hiển thị lên giao diện theo chuẩn mà mình mong muốn mm:ss nên mình đã định nghĩa thêm function convertTime() để làm điều này\nfunction convertTime(num) { let minute = `0${Math.floor(num / 60)}`.slice(-2); let second = `0${num % 60}`.slice(-2); return `${minute}:${second}`; } Function convertTime() chỉ là convert từ second -\u003e minute:second thôi chứ không có gì cả. À ở trên có 1 trích nhỏ nhỏ là mình sử dụng slice(-2) để có thể thêm số 0 vào trước nếu trường hợp second và minute \u003c 10\nĐể quá trình đếm ngược thời gian được diễn ra, người chơi cần focus vào trong ô input và bắt đầu nhập từ\ninputWordEl.addEventListener('keyup', function (e) { // Xử lý đếm ngược thời gian if (!isPlaying) { interval = setInterval(countdownTime, 1000); isPlaying = true; } // Code xử lý khi người chơi nhập từ }); Đến lúc này biến isPlaying mới phát huy sức mạnh của nó. Ban đầu trong function init() mình đã khởi tạo giá trị isPlaying = false. Khi người chơi bắt đầu nhập từ, nó sẽ kiểm tra biến isPlaying trong câu lệnh if, nếu thỏa mãn điều kiện nó sẽ thực hiện function countdownTime mỗi 1s (1000ms) 1 lần thông qua hàm setInterval()\nSau khi quá trình đếm ngược thời gian diễn ra, mình sẽ đặt giá trị isPlaying = true để đảm bảo nó không thực hiện câu lệnh trong if lần nào nữa\nVậy trong function countdownTime mình sẽ làm gì\nconst inputWordEl = document.querySelector('#input-word'); function countdownTime() { time--; timeEl.innerText = convertTime(time); if (time == 0) { clearInterval(interval); inputWordEl.disabled = true; inputWordEl.value = ''; } } Đơn giản là mỗi lần countdownTime được thực hiên, mình sẽ giảm time đi 1 đơn vị, sau đó cập nhật time mới lên trên giao diện\nKhi time = 0, mình sử dụng hàm clearInterval để dừng quá trình đếm ngược lại. Đồng thời disabled và clear hết nội dung trong ô input để không cho người chơi thực hiện nhập từ nữa (hết giờ là nghỉ chơi rồi phải không nào 😅)\nXử lý nhập từ khi chơi Phần tiếp theo của bài viết này, mình sẽ đi xử lý khi người chơi nhập từ\nĐể xử lý phần này, chúng ta cần biết cách thức chơi của trò này như thế nào\nKhi người chơi nhập từ vào ô input, chúng ta sẽ kiểm tra tại thời điểm nhập, dữ liệu trong ô input có khớp với từ đang được highlight hay không?\nNếu khớp thì không làm gì cả Nếu không khớp thì từ đang được highlight sẽ có background màu đỏ (để thông báo ông nhập sai rồi, sửa lại đi) Trường hợp người chơi bấm phím space (dấu cách) để next sang từ tiếp theo chúng ta lại phải kiểm tra lần nữa, dữ liệu trong ô input có khớp với từ trước khi next hay không?\nNếu khớp thì từ đó sẽ có chữ màu xanh Nếu không khớp thì từ đó sẽ có chữ màu đỏ Bây giờ đi đến phần code xử lý nào\ninputWordEl.addEventListener('keyup', function (e) { // Xử lý đếm ngược thời gian ... // Kiểm tra từ tại thời điểm gõ checkCurrentWord(e.target.value.trim(), words[index]); if (e.keyCode == 32) { // Kiểm tra từ tại thời điểm next compareWord(e.target.value.trim(), words[index]); // Chuyển sang từ tiếp theo index++; highlightWord(index); e.target.value = ''; } }); Ở trên mình lắng nghe sự kiện keyup của ô input. Mỗi khi người chơi gõ phím chúng ta sẽ gọi function checkCurrentWord() truyền vào 2 đối số :\ne.target.value.trim() : Nội dung trong ô input sau khi đã loại bỏ khoảng trắng ở đầu và cuối words[index] : Từ tại vị trí index trong mảng từ Mục đích của function này là kiểm tra từ tại thời điểm nhập để xem từ đang được highlight có được bắt đầu với giá trị trong ô input hay không\nTrường hợp người chơi nhấn phím space (e.keyCode == 32) tức là người chơi muốn chuyển qua từ kế tiếp. Lúc này mình sẽ gọi function compareWord() truyền vào 2 đối số tương tự như function checkCurrentWord() để kiểm tra xem dữ liệu trong ô input có khớp với từ trước khi next hay không\nĐể chuyển qua từ tiếp theo chúng ta sẽ tăng giá trị index lên 1 đơn vị ( index++), đồng thời gọi function highlightWord() để highlight từ chuẩn bị gõ tiếp theo\ne.target.value = '' Cuối cùng là clear giá trị trong ô input để cho lần gõ tiếp theo\nBây giờ chúng ta sẽ đi vào chi tiết 2 function : checkCurrentWord() và compareWord()\nfunction checkCurrentWord(inputValue, word) { let spans = document.querySelectorAll('#words span'); // Từ không được bắt đầu bằng value trong ô input if (!word.startsWith(inputValue)) { spans[index].classList.add('highlight-wrong'); } else { spans[index].classList.remove('highlight-wrong'); } } function checkCurrentWord() có tác dụng kiểm tra từ tại thời điểm gõ, mỗi khi người nhập một ký tự mới, mình sẽ so sánh nội dung của của từ đang được gõ có được bắt đầu bằng nội dung của ô input hay không? Để kiểm tra điều này, mình sử dụng phương thức startsWith() trong ES6\nNếu từ không được bắt đầu bằng value trong ô input, thêm class ‘highlight-wrong’ để css background-color thành màu đỏ cho người chơi dễ nhận biết là mình đang gõ sai và tiến hành sửa lại\nNgược lại, nếu từ được bắt đầu bằng value trong ô input, chúng ta sẽ remove class ‘highlight-wrong’ (nếu có)\nfunction compareWord(inputValue, word) { let spans = document.querySelectorAll('#words span'); Array.from(spans).map((span) =\u003e span.classList.remove('highlight-wrong')); // Từ không được bắt đầu bằng value trong ô input if (!word.startsWith(inputValue)) { spans[index].classList.add('wrong'); } // Từ được bắt đầu bằng value trong ô input nhưng độ dài khác nhau if (word.startsWith(inputValue) \u0026\u0026 inputValue.length != word.length) { spans[index].classList.add('wrong'); } // Từ và value trong ô input giống nhau if (inputValue == word) { spans[index].classList.add('correct'); } } Tiếp đến là function compareWord() để kiểm tra xem dữ liệu trong ô input có khớp với từ trước khi next hay không? Ở đây mình sẽ tiến hành kiểm tra 3 điều kiện để có thể highlight từ\nTừ không được bắt đầu bằng value trong ô input –\u003e thêm class ‘wrong’ vào thẻ span chứa từ đó Từ được bắt đầu bằng value trong ô input nhưng độ dài khác nhau -\u003e thêm class ‘wrong’ vào thẻ span chứa từ đó Từ và value trong ô input giống nhau –\u003e thêm class ‘correct’ vào thẻ span chứa từ đó Tất cả các class trên mình đã đều định nghĩa trong file style.css, các bạn có thể mở file css ra và xem thử\nVà đây là kết quả mình đã chơi thử\nCũng không đến nỗi tệ phải không nào 😄😄\nChơi lại game Khi một lượt chơi kết thúc, người chơi có nhu cầu chơi lại game (nhấn vào nút button bên cạnh ô thời gian), lúc này chúng ta sẽ xử lý phần này như sau\nconst btnReload = document.querySelector('.btn-reload'); btnReload.addEventListener('click', function () { init(); }); Đơn giản khi người chơi muốn chơi lại game, chúng ta chỉ việc gọi function init() để khởi tạo lại những thuộc tính ban đầu cho game. Nhưng có điều, lúc trước mình có disabled ô input khi time = 0 để không cho người chơi nhập từ khi thời gian kết thúc. Lúc này trong function init() chúng ta cần set lại thuộc tính disabled = false để người chơi có thể tiếp tục nhập từ khi lượt chơi mới bắt đầu\nfunction init() { time = 60; index = 0; isPlaying = false; if (interval) { clearInterval(interval); } inputWordEl.disabled = false; inputWordEl.value = ''; // Chọn ngôn ngữ // Đổi vị trí các từ trong mảng // Render từ // Hiển thị thời gian // Highlight từ đầu tiên } À, ở đây mình có bổ sung thêm một trường hợp nữa\nif (interval) { clearInterval(interval); } Lúc trước khi time = 0, mình mới dừng thời gian đếm ngược lại thông qua hàm clearInterval(), nhưng trong khi đang chơi game, người chơi có thể chơi lại game khi thời gian chưa kết thúc, để cho thời gian đếm ngược được chuẩn xác, trong function init() mình có kiểm tra xem biến interval có tồn tại hay không? Nếu nó tồn tại thì mình sẽ clearInterval đi\nỞ phần tiếp theo của Typing Game, mình sẽ hướng dẫn các bạn các chức năng còn lại bao gồm :\nCập nhật kết quả Chức năng Bảng xếp hạng người chơi Source code của phần này mình để ở đây nhé : https://github.com/buihien0109/typing-game-javascript/tree/master/typing-part-2\nCác bạn có thể tham khảo thêm khóa học này nhé:\nJavascript căn bản - Tổng hợp 12 game huyền thoại - tại đây. Khóa học Web Frontend (HTML, CSS, JavaScript) + ReactJs - tại đây ",
  "wordCount" : "1810",
  "inLanguage": "en",
  "image":"https://buihien.org/blog/typing-game/typing-game-2.png","datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://buihien.org/blog/thu-tai-cao-phim-voi-typing-game-javascript-phan-2/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Tech's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://buihien.org/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header sticky-header">
    <nav class="nav">
        <div class="logo">
            <a href="https://buihien.org" accesskey="h" title="Tech&#39;s Blog (Alt + H)">Tech&#39;s Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://buihien.org/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://buihien.org/blog" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://buihien.org/tags" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://buihien.org/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://buihien.org">Home</a>&nbsp;»&nbsp;<a href="https://buihien.org/blog/">Blogs</a></div>
    <h1 class="post-title">
      Thử tài cào phím với Typing Game - Javascript (phần 2)
    </h1>
    <div class="post-description">
      Chào mọi người, ở bài viết trước mình đã hướng dẫn các bạn render các từ trong một đoạn văn bản ra ngoài giao diện, đồng thời chúng ta cũng có thể chuyển đổi ngôn ngữ từ tiếng việt sang tiếng anh hoặc ngược lại nếu muốn
    </div>
    <div class="post-meta">


25/12/2022

</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://buihien.org/blog/typing-game/typing-game-2.png" alt="">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">‎ Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%c4%91%e1%ba%bfm-ng%c6%b0%e1%bb%a3c-th%e1%bb%9di-gian" aria-label="Đếm ngược thời gian">Đếm ngược thời gian</a></li>
                <li>
                    <a href="#x%e1%bb%ad-l%c3%bd-nh%e1%ba%adp-t%e1%bb%ab-khi-ch%c6%a1i" aria-label="Xử lý nhập từ khi chơi">Xử lý nhập từ khi chơi</a></li>
                <li>
                    <a href="#ch%c6%a1i-l%e1%ba%a1i-game" aria-label="Chơi lại game">Chơi lại game</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Chào mọi người, ở <a href="https://techmaster.vn/posts/36501/thu-tai-cao-phim-voi-typing-game-javascript-phan-1">bài viết trước</a> mình đã hướng dẫn các bạn render các từ trong một đoạn văn bản ra ngoài giao diện, đồng thời chúng ta cũng có thể chuyển đổi ngôn ngữ từ tiếng việt sang tiếng anh hoặc ngược lại nếu muốn</p>
<p>Trong khuôn khổ bài viết bài này, chúng ta cũng nhau đi thực hiện một số công việc tiếp theo trong Typing Game bao gồm :</p>
<ul>
<li>Đếm ngược thời gian</li>
<li>Xử lý khi gõ từ</li>
</ul>
<blockquote>
<p>Nếu các bạn thích chủ đề làm Game và Ứng dụng bằng Javascript thì hãy comment ở bên dưới bài viết cho mình biết nhé 😆</p>
</blockquote>
<p>Bây giờ thì cùng bắt đầu thôi nào 😄</p>
<h2 id="đếm-ngược-thời-gian">Đếm ngược thời gian<a hidden class="anchor" aria-hidden="true" href="#đếm-ngược-thời-gian">#</a></h2>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">const timeEl = document.querySelector(&#39;#time&#39;);

let time;
let interval;
let isPlaying;

function init() {
    time = 60;
    index = 0;
    isPlaying = false;

    // Chọn ngôn ngữ

    // Đổi vị trí các từ trong mảng

    // Render từ

    // Hiển thị thời gian
    timeEl.innerText = convertTime(time);

    // Highlight từ đầu tiên
}
</code></pre><p>Ở đoạn code trên mình có khai báo 3 biến : <strong>time</strong>, <strong>interval</strong>, <strong>isPlaying</strong></p>
<ul>
<li><strong>time</strong> : Thời gian chơi game (khi bắt đầu game thì time sẽ bắt đầu đếm ngược)</li>
<li><strong>interval</strong> : Lưu trữ giá trị của hàm <strong>setInterval()</strong> (phục vụ cho mục đích đếm ngược thời gian), về sau khi thời gian = 0, lúc này mình sẽ dùng hàm <strong>clearInterval()</strong> để dừng quá trình đếm ngược thời gian dựa vào biến interval</li>
<li><strong>isPlaying</strong> : Đây là biến để kiểm tra xem người chơi đã bắt đầu gõ phím chưa để chúng ta bắt đầu quá trình đếm ngược thời gian</li>
</ul>
<p>Trong function <strong>init()</strong> mình sẽ khởi tạo giá trị <strong>time = 60</strong> (thời gian chơi game là 60s), <strong>isPlaying = false</strong> (người chơi chưa gõ phím để bắt đầu). Đồng thời cũng hiển thị thời gian lên trên giao diện (mới chỉ hiển thị thôi nhé, chứ chưa đếm ngược đâu)</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">// Hiển thị thời gian
timeEl.innerText = convertTime(time);
</code></pre><p>Vì mình muốn thời gian hiển thị lên giao diện theo chuẩn mà mình mong muốn <strong>mm:ss</strong> nên mình đã định nghĩa thêm function <strong>convertTime()</strong> để làm điều này</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">function convertTime(num) {
    let minute = `0${Math.floor(num / 60)}`.slice(-2);
    let second = `0${num % 60}`.slice(-2);
    return `${minute}:${second}`;
}
</code></pre><p>Function <strong>convertTime()</strong> chỉ là convert từ <strong>second -&gt; minute:second</strong> thôi chứ không có gì cả. À ở trên có 1 trích nhỏ nhỏ là mình sử dụng <strong>slice(-2)</strong> để có thể thêm số 0 vào trước nếu trường hợp second và minute &lt; 10</p>
<p>Để quá trình đếm ngược thời gian được diễn ra, người chơi cần focus vào trong ô input và bắt đầu nhập từ</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">inputWordEl.addEventListener(&#39;keyup&#39;, function (e) {
    // Xử lý đếm ngược thời gian
    if (!isPlaying) {
        interval = setInterval(countdownTime, 1000);
        isPlaying = true;
    }

    // Code xử lý khi người chơi nhập từ
});
</code></pre><p>Đến lúc này biến <strong>isPlaying</strong> mới phát huy sức mạnh của nó. Ban đầu trong function <strong>init()</strong> mình đã khởi tạo giá trị <strong>isPlaying = false</strong>. Khi người chơi bắt đầu nhập từ, nó sẽ kiểm tra biến <strong>isPlaying</strong> trong câu lệnh <strong>if</strong>, nếu thỏa mãn điều kiện nó sẽ thực hiện function <strong>countdownTime</strong> mỗi 1s (1000ms) 1 lần thông qua hàm <strong>setInterval()</strong></p>
<p>Sau khi quá trình đếm ngược thời gian diễn ra, mình sẽ đặt giá trị <strong>isPlaying = true</strong> để đảm bảo nó không thực hiện câu lệnh trong <strong>if</strong> lần nào nữa</p>
<p>Vậy trong function <strong>countdownTime</strong> mình sẽ làm gì</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">const inputWordEl = document.querySelector(&#39;#input-word&#39;);

function countdownTime() {
    time--;
    timeEl.innerText = convertTime(time);

    if (time == 0) {
        clearInterval(interval);
        inputWordEl.disabled = true;
        inputWordEl.value = &#39;&#39;;
    }
}
</code></pre><p>Đơn giản là mỗi lần <strong>countdownTime</strong> được thực hiên, mình sẽ giảm <strong>time</strong> đi 1 đơn vị, sau đó cập nhật <strong>time</strong> mới lên trên giao diện</p>
<p>Khi <strong>time = 0</strong>, mình sử dụng hàm <strong>clearInterval</strong> để dừng quá trình đếm ngược lại. Đồng thời <strong>disabled</strong> và <strong>clear</strong> hết nội dung trong ô input để không cho người chơi thực hiện nhập từ nữa (hết giờ là nghỉ chơi rồi phải không nào 😅)</p>
<hr>
<h2 id="xử-lý-nhập-từ-khi-chơi">Xử lý nhập từ khi chơi<a hidden class="anchor" aria-hidden="true" href="#xử-lý-nhập-từ-khi-chơi">#</a></h2>
<p>Phần tiếp theo của bài viết này, mình sẽ đi xử lý khi người chơi nhập từ</p>
<p>Để xử lý phần này, chúng ta cần biết cách thức chơi của trò này như thế nào</p>
<p>Khi người chơi nhập từ vào ô input, chúng ta sẽ kiểm tra tại thời điểm nhập, dữ liệu trong ô input có khớp với từ đang được highlight hay không?</p>
<ul>
<li>Nếu khớp thì không làm gì cả</li>
<li>Nếu không khớp thì từ đang được highlight sẽ có <strong>background màu đỏ</strong> <em>(để thông báo ông nhập sai rồi, sửa lại đi)</em></li>
</ul>
<p>Trường hợp người chơi bấm phím space (dấu cách) để next sang từ tiếp theo chúng ta lại phải kiểm tra lần nữa, dữ liệu trong ô input có khớp với từ trước khi next hay không?</p>
<ul>
<li>Nếu khớp thì từ đó sẽ có <strong>chữ màu xanh</strong></li>
<li>Nếu không khớp thì từ đó sẽ có <strong>chữ màu đỏ</strong></li>
</ul>
<p>Bây giờ đi đến phần code xử lý nào</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">inputWordEl.addEventListener(&#39;keyup&#39;, function (e) {
    // Xử lý đếm ngược thời gian
    ...

    // Kiểm tra từ tại thời điểm gõ
    checkCurrentWord(e.target.value.trim(), words[index]);

    if (e.keyCode == 32) {
        // Kiểm tra từ tại thời điểm next
        compareWord(e.target.value.trim(), words[index]);

        // Chuyển sang từ tiếp theo
        index++;
        highlightWord(index);

        e.target.value = &#39;&#39;;
    }
});
</code></pre><p>Ở trên mình lắng nghe sự kiện keyup của ô input. Mỗi khi người chơi gõ phím chúng ta sẽ gọi function <strong>checkCurrentWord()</strong> truyền vào 2 đối số :</p>
<ul>
<li><strong>e.target.value.trim()</strong> : Nội dung trong ô input sau khi đã loại bỏ khoảng trắng ở đầu và cuối</li>
<li><strong>words[index]</strong> : Từ tại vị trí index trong mảng từ</li>
</ul>
<p>Mục đích của function này là kiểm tra từ tại thời điểm nhập để xem từ đang được highlight có được bắt đầu với giá trị trong ô input hay không</p>
<p>Trường hợp người chơi nhấn phím <strong>space (e.keyCode == 32)</strong> tức là người chơi muốn chuyển qua từ kế tiếp. Lúc này mình sẽ gọi function <strong>compareWord()</strong> truyền vào 2 đối số tương tự như function <strong>checkCurrentWord()</strong> để kiểm tra xem dữ liệu trong ô input có khớp với từ trước khi next hay không</p>
<p>Để chuyển qua từ tiếp theo chúng ta sẽ tăng giá trị index lên 1 đơn vị ( <strong>index++</strong>), đồng thời gọi function <strong>highlightWord()</strong> để highlight từ chuẩn bị gõ tiếp theo</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">e.target.value = &#39;&#39;
</code></pre><p>Cuối cùng là clear giá trị trong ô input để cho lần gõ tiếp theo</p>
<hr>
<p>Bây giờ chúng ta sẽ đi vào chi tiết 2 function : <strong>checkCurrentWord()</strong> và <strong>compareWord()</strong></p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">function checkCurrentWord(inputValue, word) {
    let spans = document.querySelectorAll(&#39;#words span&#39;);

    // Từ không được bắt đầu bằng value trong ô input
    if (!word.startsWith(inputValue)) {
        spans[index].classList.add(&#39;highlight-wrong&#39;);
    } else {
        spans[index].classList.remove(&#39;highlight-wrong&#39;);
    }
}
</code></pre><p>function <strong>checkCurrentWord()</strong> có tác dụng kiểm tra từ tại thời điểm gõ, mỗi khi người nhập một ký tự mới, mình sẽ so sánh nội dung của của từ đang được gõ có được bắt đầu bằng nội dung của ô input hay không? Để kiểm tra điều này, mình sử dụng phương thức <strong>startsWith()</strong> trong ES6</p>
<p>Nếu từ không được bắt đầu bằng value trong ô input, thêm class <strong>&lsquo;highlight-wrong&rsquo;</strong> để css background-color thành màu đỏ cho người chơi dễ nhận biết là mình đang gõ sai và tiến hành sửa lại</p>
<p>Ngược lại, nếu từ được bắt đầu bằng value trong ô input, chúng ta sẽ remove class <strong>&lsquo;highlight-wrong&rsquo;</strong> (nếu có)</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">function compareWord(inputValue, word) {
    let spans = document.querySelectorAll(&#39;#words span&#39;);
    Array.from(spans).map((span) =&gt; span.classList.remove(&#39;highlight-wrong&#39;));

    // Từ không được bắt đầu bằng value trong ô input
    if (!word.startsWith(inputValue)) {
        spans[index].classList.add(&#39;wrong&#39;);
    }

    // Từ được bắt đầu bằng value trong ô input nhưng độ dài khác nhau
    if (word.startsWith(inputValue) &amp;&amp; inputValue.length != word.length) {
        spans[index].classList.add(&#39;wrong&#39;);
    }

    // Từ và value trong ô input giống nhau
    if (inputValue == word) {
        spans[index].classList.add(&#39;correct&#39;);
    }
}
</code></pre><p>Tiếp đến là function <strong>compareWord()</strong> để kiểm tra xem dữ liệu trong ô input có khớp với từ trước khi next hay không? Ở đây mình sẽ tiến hành kiểm tra 3 điều kiện để có thể highlight từ</p>
<ul>
<li>Từ không được bắt đầu bằng value trong ô input &ndash;&gt; thêm class <strong>&lsquo;wrong&rsquo;</strong> vào thẻ span chứa từ đó</li>
<li>Từ được bắt đầu bằng value trong ô input nhưng độ dài khác nhau -&gt; thêm class <strong>&lsquo;wrong&rsquo;</strong> vào thẻ span chứa từ đó</li>
<li>Từ và value trong ô input giống nhau &ndash;&gt; thêm class <strong>&lsquo;correct&rsquo;</strong> vào thẻ span chứa từ đó</li>
</ul>
<p>Tất cả các class trên mình đã đều định nghĩa trong file <strong>style.css</strong>, các bạn có thể mở file css ra và xem thử</p>
<p>Và đây là kết quả mình đã chơi thử</p>
<p><img loading="lazy" src="https://media.techmaster.vn/api/static/9479/c2n5ofc51co7q82829gg" alt="chơi thử game typing"  />
</p>
<p>Cũng không đến nỗi tệ phải không nào 😄😄</p>
<hr>
<h2 id="chơi-lại-game">Chơi lại game<a hidden class="anchor" aria-hidden="true" href="#chơi-lại-game">#</a></h2>
<p>Khi một lượt chơi kết thúc, người chơi có nhu cầu chơi lại game (nhấn vào nút button bên cạnh ô thời gian), lúc này chúng ta sẽ xử lý phần này như sau</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">const btnReload = document.querySelector(&#39;.btn-reload&#39;);
btnReload.addEventListener(&#39;click&#39;, function () {
    init();
});
</code></pre><p>Đơn giản khi người chơi muốn chơi lại game, chúng ta chỉ việc gọi function <strong>init()</strong> để khởi tạo lại những thuộc tính ban đầu cho game. Nhưng có điều, lúc trước mình có <strong>disabled</strong> ô input khi <strong>time = 0</strong> để không cho người chơi nhập từ khi thời gian kết thúc. Lúc này trong function <strong>init()</strong> chúng ta cần set lại thuộc tính <strong>disabled = false</strong> để người chơi có thể tiếp tục nhập từ khi lượt chơi mới bắt đầu</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">function init() {
    time = 60;
    index = 0;
    isPlaying = false;

    if (interval) {
        clearInterval(interval);
    }

    inputWordEl.disabled = false;
    inputWordEl.value = &#39;&#39;;

    // Chọn ngôn ngữ
    // Đổi vị trí các từ trong mảng
    // Render từ
    // Hiển thị thời gian
    // Highlight từ đầu tiên
}
</code></pre><p>À, ở đây mình có bổ sung thêm một trường hợp nữa</p>
<pre tabindex="0"><code class="language-lang-javascript" data-lang="lang-javascript">    if (interval) {
        clearInterval(interval);
    }
</code></pre><p>Lúc trước khi <strong>time = 0</strong>, mình mới dừng thời gian đếm ngược lại thông qua hàm <strong>clearInterval()</strong>, nhưng trong khi đang chơi game, người chơi có thể chơi lại game khi thời gian chưa kết thúc, để cho thời gian đếm ngược được chuẩn xác, trong function <strong>init()</strong> mình có kiểm tra xem biến <strong>interval</strong> có tồn tại hay không? Nếu nó tồn tại thì mình sẽ <strong>clearInterval</strong> đi</p>
<hr>
<p>Ở phần tiếp theo của <strong>Typing Game</strong>, mình sẽ hướng dẫn các bạn các chức năng còn lại bao gồm :</p>
<ul>
<li>Cập nhật kết quả</li>
<li>Chức năng Bảng xếp hạng người chơi</li>
</ul>
<p>Source code của phần này mình để ở đây nhé : <a href="https://github.com/buihien0109/typing-game-javascript/tree/master/typing-part-2">https://github.com/buihien0109/typing-game-javascript/tree/master/typing-part-2</a></p>
<p>Các bạn có thể tham khảo thêm khóa học này nhé:</p>
<ul>
<li>Javascript căn bản - Tổng hợp 12 game huyền thoại - <a href="https://techmaster.vn/khoa-hoc/ev5/javascript-can-ban-tong-hop-12-game-huyen-thoai">tại đây</a>.</li>
<li>Khóa học Web Frontend (HTML, CSS, JavaScript) + ReactJs - <a href="https://techmaster.vn/lo-trinh/front-end">tại đây</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://buihien.org/tags/frontend/">FrontEnd</a></li>
      <li><a href="https://buihien.org/tags/javascript/">Javascript</a></li>
      <li><a href="https://buihien.org/tags/web/">Web</a></li>
      <li><a href="https://buihien.org/tags/game/">Game</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://buihien.org">Tech&#39;s Blog</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
